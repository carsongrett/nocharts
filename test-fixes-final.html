<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Fixes Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Final Fixes Test</h1>
    
    <div class="test-section">
        <h3>Test Complete Data Flow</h3>
        <button onclick="testCompleteFlow()">Test Complete Flow</button>
        <div id="completeFlowResults"></div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/data.js"></script>
    
    <script>
        async function testCompleteFlow() {
            const resultsDiv = document.getElementById('completeFlowResults');
            resultsDiv.innerHTML = '<p class="info">Testing complete data flow...</p>';
            
            try {
                // Get comprehensive data
                const result = await API.getComprehensiveStockData('AAPL');
                
                // Process data like ticker.js does
                const processed = {
                    symbol: result.symbol,
                    overview: result.overview ? DataProcessor.processFinnhubProfile(result.overview) : null,
                    quote: result.quote ? DataProcessor.processFinnhubQuote(result.quote) : null,
                    basicFinancials: result.basicFinancials ? DataProcessor.processFinnhubBasicFinancials(result.basicFinancials) : null,
                    earnings: result.earnings ? DataProcessor.processFinnhubEarnings(result.earnings) : null,
                    news: result.news ? DataProcessor.processNewsArticles(result.news) : [],
                    lastUpdated: result.lastUpdated
                };
                
                let results = '<p class="success">✅ Complete data flow test:</p>';
                
                results += '<h4>Processed Basic Financials:</h4>';
                results += `<pre>${JSON.stringify(processed.basicFinancials, null, 2)}</pre>`;
                
                results += '<h4>Expected Display Values:</h4>';
                if (processed.basicFinancials) {
                    const bf = processed.basicFinancials;
                    results += `
                        <ul>
                            <li><strong>P/E Ratio:</strong> ${bf.peRatio ? bf.peRatio.toFixed(2) : 'N/A'}</li>
                            <li><strong>Dividend Yield:</strong> ${bf.dividendYield ? `${bf.dividendYield.toFixed(2)}%` : 'N/A'}</li>
                            <li><strong>Revenue Growth:</strong> ${bf.revenueGrowth ? `${bf.revenueGrowth.toFixed(2)}%` : 'N/A'}</li>
                            <li><strong>52 Week Range:</strong> ${bf.weekHigh && bf.weekLow ? `$${bf.weekLow.toFixed(2)} - $${bf.weekHigh.toFixed(2)}` : 'N/A'}</li>
                            <li><strong>Profit Margin:</strong> ${bf.profitMargin ? `${bf.profitMargin.toFixed(2)}%` : 'N/A'}</li>
                            <li><strong>Current Ratio:</strong> ${bf.currentRatio ? bf.currentRatio.toFixed(2) : 'N/A'}</li>
                        </ul>
                    `;
                }
                
                if (processed.overview) {
                    const marketCapValue = parseFloat(processed.overview.marketCap);
                    let marketCap = 'N/A';
                    if (marketCapValue >= 1e6) {
                        marketCap = `$${(marketCapValue / 1e3).toFixed(1)}T`;
                    } else if (marketCapValue >= 1e3) {
                        marketCap = `$${(marketCapValue / 1e3).toFixed(1)}B`;
                    } else {
                        marketCap = `$${marketCapValue.toFixed(1)}M`;
                    }
                    results += `<p><strong>Market Cap:</strong> ${marketCap}</p>`;
                }
                
                resultsDiv.innerHTML = results;
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">❌ Complete flow test failed: ${error.message}</p>`;
                console.error('Complete flow test error:', error);
            }
        }
    </script>
</body>
</html> 