<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Data Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0; }
        .data-item { padding: 5px; background: #f5f5f5; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Enhanced Data Test</h1>
    
    <div class="test-section">
        <h3>Test New API Functions</h3>
        <button onclick="testNewAPIs()">Test New APIs</button>
        <div id="apiResults"></div>
    </div>
    
    <div class="test-section">
        <h3>Test Comprehensive Data</h3>
        <button onclick="testComprehensive()">Test Comprehensive Data</button>
        <div id="comprehensiveResults"></div>
    </div>
    
    <div class="test-section">
        <h3>Test Data Processing</h3>
        <button onclick="testDataProcessing()">Test Data Processing</button>
        <div id="processingResults"></div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/data.js"></script>
    
    <script>
        async function testNewAPIs() {
            const resultsDiv = document.getElementById('apiResults');
            resultsDiv.innerHTML = '<p class="info">Testing new API functions...</p>';
            
            try {
                // Test basic financials
                console.log('Testing basic financials...');
                const basicFinancials = await API.getFinnhubBasicFinancials('AAPL');
                console.log('Basic financials result:', basicFinancials);
                
                // Test earnings
                console.log('Testing earnings...');
                const earnings = await API.getFinnhubEarnings('AAPL');
                console.log('Earnings result:', earnings);
                
                let results = '<p class="success">✅ New API functions test:</p>';
                
                if (basicFinancials && Object.keys(basicFinancials).length > 0) {
                    results += '<p class="success">✅ Basic financials API working</p>';
                    results += '<div class="data-grid">';
                    if (basicFinancials.peRatio) results += `<div class="data-item"><strong>P/E:</strong> ${basicFinancials.peRatio}</div>`;
                    if (basicFinancials.dividendYield) results += `<div class="data-item"><strong>Dividend:</strong> ${basicFinancials.dividendYield}%</div>`;
                    if (basicFinancials.pbRatio) results += `<div class="data-item"><strong>P/B:</strong> ${basicFinancials.pbRatio}</div>`;
                    if (basicFinancials.beta) results += `<div class="data-item"><strong>Beta:</strong> ${basicFinancials.beta}</div>`;
                    results += '</div>';
                } else {
                    results += '<p class="error">❌ Basic financials API failed</p>';
                }
                
                if (earnings && Object.keys(earnings).length > 0) {
                    results += '<p class="success">✅ Earnings API working</p>';
                    results += '<div class="data-grid">';
                    if (earnings.eps) results += `<div class="data-item"><strong>EPS:</strong> $${earnings.eps}</div>`;
                    if (earnings.revenue) results += `<div class="data-item"><strong>Revenue:</strong> $${earnings.revenue}B</div>`;
                    results += '</div>';
                } else {
                    results += '<p class="error">❌ Earnings API failed</p>';
                }
                
                resultsDiv.innerHTML = results;
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">❌ API test failed: ${error.message}</p>`;
                console.error('API test error:', error);
            }
        }
        
        async function testComprehensive() {
            const resultsDiv = document.getElementById('comprehensiveResults');
            resultsDiv.innerHTML = '<p class="info">Testing comprehensive data...</p>';
            
            try {
                const result = await API.getComprehensiveStockData('AAPL');
                console.log('Comprehensive result:', result);
                
                let results = '<p class="success">✅ Comprehensive data test:</p>';
                results += `<p><strong>Symbol:</strong> ${result.symbol}</p>`;
                results += `<p><strong>Profile:</strong> ${result.overview ? 'Available' : 'Missing'}</p>`;
                results += `<p><strong>Quote:</strong> ${result.quote ? 'Available' : 'Missing'}</p>`;
                results += `<p><strong>Basic Financials:</strong> ${result.basicFinancials ? 'Available' : 'Missing'}</p>`;
                results += `<p><strong>Earnings:</strong> ${result.earnings ? 'Available' : 'Missing'}</p>`;
                results += `<p><strong>News:</strong> ${result.news ? result.news.length : 0} articles</p>`;
                
                resultsDiv.innerHTML = results;
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">❌ Comprehensive test failed: ${error.message}</p>`;
                console.error('Comprehensive test error:', error);
            }
        }
        
        function testDataProcessing() {
            const resultsDiv = document.getElementById('processingResults');
            resultsDiv.innerHTML = '<p class="info">Testing data processing functions...</p>';
            
            try {
                const functions = [
                    'processFinnhubBasicFinancials',
                    'processFinnhubEarnings'
                ];
                
                let results = '<p class="success">✅ Data processing test:</p>';
                
                functions.forEach(funcName => {
                    if (typeof DataProcessor[funcName] === 'function') {
                        results += `<p class="success">✅ ${funcName} is available</p>`;
                    } else {
                        results += `<p class="error">❌ ${funcName} is NOT available</p>`;
                    }
                });
                
                // Test with sample data
                const sampleBasicFinancials = {
                    peRatio: 28.5,
                    dividendYield: 0.5,
                    pbRatio: 15.2,
                    beta: 1.2
                };
                
                try {
                    const processed = DataProcessor.processFinnhubBasicFinancials(sampleBasicFinancials);
                    results += `<p class="success">✅ processFinnhubBasicFinancials works</p>`;
                    results += `<p><strong>P/E:</strong> ${processed.peRatio}</p>`;
                    results += `<p><strong>Dividend:</strong> ${processed.dividendYield}%</p>`;
                } catch (error) {
                    results += `<p class="error">❌ processFinnhubBasicFinancials failed: ${error.message}</p>`;
                }
                
                resultsDiv.innerHTML = results;
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">❌ Processing test error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html> 