<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Response Investigation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 5px; overflow-x: auto; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>API Response Investigation</h1>
    
    <div class="test-section">
        <h3>1. Test Stock Metrics Raw Response</h3>
        <button onclick="testStockMetricsRaw()">Test Stock Metrics Raw</button>
        <div id="metricsRawResults"></div>
    </div>
    
    <div class="test-section">
        <h3>2. Test Stock Earnings Raw Response</h3>
        <button onclick="testStockEarningsRaw()">Test Stock Earnings Raw</button>
        <div id="earningsRawResults"></div>
    </div>
    
    <div class="test-section">
        <h3>3. Test Data Processing</h3>
        <button onclick="testDataProcessing()">Test Data Processing</button>
        <div id="processingResults"></div>
    </div>
    
    <div class="test-section">
        <h3>4. Test Main App Data Flow</h3>
        <button onclick="testMainAppFlow()">Test Main App Flow</button>
        <div id="mainAppFlowResults"></div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/data.js"></script>
    
    <script>
        async function testStockMetricsRaw() {
            const resultsDiv = document.getElementById('metricsRawResults');
            resultsDiv.innerHTML = '<p class="info">Testing stock metrics raw response...</p>';
            
            try {
                console.log('Testing stock metrics raw response...');
                const result = await API.getFinnhubBasicFinancials('AAPL');
                console.log('Stock metrics raw result:', result);
                
                if (result && !result.error) {
                    resultsDiv.innerHTML = `
                        <p class="success">✅ Stock metrics raw response:</p>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    `;
                } else {
                    resultsDiv.innerHTML = `<p class="error">❌ Stock metrics failed: ${result?.error || 'Unknown error'}</p>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">❌ Stock metrics test failed: ${error.message}</p>`;
                console.error('Stock metrics test error:', error);
            }
        }
        
        async function testStockEarningsRaw() {
            const resultsDiv = document.getElementById('earningsRawResults');
            resultsDiv.innerHTML = '<p class="info">Testing stock earnings raw response...</p>';
            
            try {
                console.log('Testing stock earnings raw response...');
                const result = await API.getFinnhubEarnings('AAPL');
                console.log('Stock earnings raw result:', result);
                
                if (result && !result.error) {
                    resultsDiv.innerHTML = `
                        <p class="success">✅ Stock earnings raw response:</p>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    `;
                } else {
                    resultsDiv.innerHTML = `<p class="error">❌ Stock earnings failed: ${result?.error || 'Unknown error'}</p>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">❌ Stock earnings test failed: ${error.message}</p>`;
                console.error('Stock earnings test error:', error);
            }
        }
        
        async function testDataProcessing() {
            const resultsDiv = document.getElementById('processingResults');
            resultsDiv.innerHTML = '<p class="info">Testing data processing...</p>';
            
            try {
                // Get raw data
                const metricsRaw = await API.getFinnhubBasicFinancials('AAPL');
                const earningsRaw = await API.getFinnhubEarnings('AAPL');
                
                // Process data
                const processedMetrics = DataProcessor.processFinnhubBasicFinancials(metricsRaw);
                const processedEarnings = DataProcessor.processFinnhubEarnings(earningsRaw);
                
                let results = '<p class="success">✅ Data processing test:</p>';
                
                results += '<h4>Raw Metrics Data:</h4>';
                results += `<pre>${JSON.stringify(metricsRaw, null, 2)}</pre>`;
                
                results += '<h4>Processed Metrics Data:</h4>';
                results += `<pre>${JSON.stringify(processedMetrics, null, 2)}</pre>`;
                
                results += '<h4>Raw Earnings Data:</h4>';
                results += `<pre>${JSON.stringify(earningsRaw, null, 2)}</pre>`;
                
                results += '<h4>Processed Earnings Data:</h4>';
                results += `<pre>${JSON.stringify(processedEarnings, null, 2)}</pre>`;
                
                resultsDiv.innerHTML = results;
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">❌ Data processing test failed: ${error.message}</p>`;
                console.error('Data processing test error:', error);
            }
        }
        
        async function testMainAppFlow() {
            const resultsDiv = document.getElementById('mainAppFlowResults');
            resultsDiv.innerHTML = '<p class="info">Testing main app data flow...</p>';
            
            try {
                const result = await API.getComprehensiveStockData('AAPL');
                console.log('Main app flow result:', result);
                
                let results = '<p class="success">✅ Main app data flow test:</p>';
                
                results += '<h4>Comprehensive Data Structure:</h4>';
                results += `<pre>${JSON.stringify(result, null, 2)}</pre>`;
                
                // Test the processing that happens in ticker.js
                if (typeof DataProcessor !== 'undefined') {
                    const processed = {
                        symbol: result.symbol,
                        overview: result.overview ? DataProcessor.processFinnhubProfile(result.overview) : null,
                        quote: result.quote ? DataProcessor.processFinnhubQuote(result.quote) : null,
                        basicFinancials: result.basicFinancials ? DataProcessor.processFinnhubBasicFinancials(result.basicFinancials) : null,
                        earnings: result.earnings ? DataProcessor.processFinnhubEarnings(result.earnings) : null,
                        news: result.news ? DataProcessor.processNewsArticles(result.news) : [],
                        lastUpdated: result.lastUpdated
                    };
                    
                    results += '<h4>Processed Data (like ticker.js):</h4>';
                    results += `<pre>${JSON.stringify(processed, null, 2)}</pre>`;
                }
                
                resultsDiv.innerHTML = results;
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">❌ Main app flow test failed: ${error.message}</p>`;
                console.error('Main app flow test error:', error);
            }
        }
    </script>
</body>
</html> 