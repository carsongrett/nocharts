<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Test - Reddit Fallback</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .success { border-color: #4CAF50; background-color: #f1f8e9; }
        .error { border-color: #f44336; background-color: #ffebee; }
        .loading { border-color: #2196F3; background-color: #e3f2fd; }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976D2; }
        .integration-info {
            background: #e8f5e8;
            border: 1px solid #4CAF50;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Integration Test - Reddit Fallback</h1>
        
        <div class="integration-info">
            <h3>üéØ Integration Test</h3>
            <p>This test verifies that the Reddit fallback is properly integrated into your main application.</p>
            <ul>
                <li>‚úÖ <strong>News API fails</strong> (simulated 426 error)</li>
                <li>‚úÖ <strong>Reddit API succeeds</strong> (via CORS proxy)</li>
                <li>‚úÖ <strong>UI displays correctly</strong> with Reddit metadata</li>
                <li>‚úÖ <strong>Timeline renders</strong> with proper styling</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>Test Integration</h3>
            <p>Click the button below to test the full integration with your main application components.</p>
            <button onclick="testFullIntegration()">Test Full Integration</button>
            <div id="testResults"></div>
        </div>
        
        <div class="test-section">
            <h3>Timeline Preview</h3>
            <div id="timelinePreview"></div>
        </div>
    </div>

    <!-- Load all dependencies -->
    <script src="js/config.js"></script>
    <script src="js/mock-data.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/data.js"></script>
    <script src="js/timeline.js"></script>

    <script>
        let timeline;
        
        async function testFullIntegration() {
            const resultsDiv = document.getElementById('testResults');
            const timelineDiv = document.getElementById('timelinePreview');
            
            resultsDiv.innerHTML = '<div class="loading">üîÑ Testing full integration...</div>';
            timelineDiv.innerHTML = '';
            
            try {
                console.log('üß™ Testing full integration...');
                
                // Step 1: Force News API to fail (simulate deployed environment)
                console.log('üîß Step 1: Forcing News API to fail...');
                const originalApiKey = CONFIG.NEWS_API_KEY;
                CONFIG.NEWS_API_KEY = 'INVALID_KEY_FOR_TESTING';
                
                // Step 2: Get comprehensive stock data (should use Reddit fallback)
                console.log('üîß Step 2: Getting comprehensive stock data...');
                const stockData = await API.getComprehensiveStockData('AAPL');
                
                // Step 3: Restore original API key
                CONFIG.NEWS_API_KEY = originalApiKey;
                
                if (!stockData.news || stockData.news.length === 0) {
                    resultsDiv.innerHTML = `<div class="error">‚ùå Integration failed: No news data found.</div>`;
                    return;
                }
                
                resultsDiv.innerHTML = `<div class="success">‚úÖ Integration successful! Found ${stockData.news.length} posts via Reddit fallback.</div>`;
                
                // Step 4: Test timeline rendering
                console.log('üîß Step 4: Testing timeline rendering...');
                timelineDiv.innerHTML = '<div id="testTimeline"></div>';
                timeline = new Timeline('testTimeline');
                timeline.init();
                
                // Process news data for timeline
                const processedNews = stockData.news.map(article => ({
                    type: 'news',
                    title: article.title,
                    description: article.description,
                    url: article.url,
                    source: article.source,
                    publishedAt: article.publishedAt,
                    relativeTime: article.relativeTime,
                    sentiment: article.sentiment,
                    category: article.category,
                    score: article.score,
                    numComments: article.numComments
                }));
                
                timeline.addItems(processedNews);
                timeline.render();
                
                console.log('‚úÖ Timeline rendered successfully');
                
            } catch (error) {
                console.error('‚ùå Integration test failed:', error);
                resultsDiv.innerHTML = `<div class="error">‚ùå Integration test failed: ${error.message}</div>`;
                
                // Restore original API key on error
                CONFIG.NEWS_API_KEY = originalApiKey;
            }
        }
        
        // Auto-test on page load
        window.addEventListener('load', () => {
            console.log('üöÄ Integration test page loaded');
            console.log('üìä Available components:', {
                API: typeof API !== 'undefined',
                Timeline: typeof Timeline !== 'undefined',
                Utils: typeof Utils !== 'undefined'
            });
        });
    </script>
</body>
</html> 